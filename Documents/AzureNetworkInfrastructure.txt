KobraLocksAzureInfrastructure/
├── Networking/
│   ├── VirtualNetworks/
│   │   ├── KobraLocksMainVnet/
│   │   │   ├── Address Space: "10.0.0.0/16"
│   │   │   ├── DNS Servers: Azure-provided
│   │   │   ├── Subnets/
│   │   │   │   ├── AppServiceSubnet/
│   │   │   │   │   ├── Range: "10.0.0.0/24"
│   │   │   │   │   ├── ServiceEndpoints/
│   │   │   │   │   │   └── Microsoft.Sql
│   │   │   │   │   ├── Network Security Group: AppServicesNSG
│   │   │   │   │   ├── Route Table: AppServiceRouteTable (with necessary routes configured)
│   │   │   │   │   └── VNet Integration: Enabled for KobraLocksBackend and KobraLocksFrontend
│   │   │   │   ├── DatabaseSubnet/
│   │   │   │   │   ├── Range: "10.0.1.0/24"
│   │   │   │   │   ├── ServiceEndpoints/
│   │   │   │   │   │   └── Microsoft.Sql
│   │   │   │   │   ├── Network Security Group: DatabaseNSG
│   │   │   │   │   └── Route Table: DatabaseRouteTable (with necessary routes configured)
│   │   │   │   ├── AksSubnet/
│   │   │   │   │   ├── Range: "10.0.2.0/24"
│   │   │   │   │   ├── ServiceEndpoints: Not required
│   │   │   │   │   └── Network Security Group: AKSNSG
│   │   │   │   ├── PrivateEndpointSubnet/    # Subnet dedicated to Azure Private Endpoints
│   │   │   │   │   ├── Range: "10.0.3.0/24"   # Non-overlapping CIDR block within VNet address space
│   │   │   │   │   └── ServiceEndpoints/     # Generally, Private Endpoints do not require service endpoints
│   │   │   │   │       └── None so far
│   │   │   │   └── AppGatewaySubnet/                # Dedicated subnet for Application Gateway
│   │   │   │       ├── Range: "10.0.4.0/24"          # Define an appropriate CIDR block
│   │   │   │ 		├── Network Security Group: AppServicesNSG
│   │   │   │       └── ServiceEndpoints/             # Service endpoints are typically not required for App Gateway subnet
│   │   │   │           └── None required
│   │   │   ├── Peering/
│   │   │   │   ├── PeeringWithKobraLocksDRVnet/
│   │   │   │   │   ├── Name: "MainToDRPeering"
│   │   │   │   │   └── Settings: [AllowVirtualNetworkAccess: true, AllowForwardedTraffic: true, AllowGatewayTransit: false, UseRemoteGateways: false]
│   │   │   │   └── PeeringWithOtherVnets (if necessary)
│   │   │   ├── DDoS Protection: Standard (Optional)
│   │   │   ├── Firewall: Configured with Application Rules and Network Rules (as required)
│   │   │   ├── Microsoft Defender for Cloud: Enabled
│   │   │   ├── Private Endpoints: Configured for databases and storage accounts
│   │   │   └── Locks: Applied to critical resources to prevent accidental deletion or modification
│   │   └── KobraLocksDRVnet/
│   │       ├── Address Space: "10.1.0.0/16"
│   │       ├── Subnets: Configured as needed for disaster recovery
│   │       ├── Bastion: Configured for secure RDP/SSH access to VMs
│   │       └── Peering/
│   │           ├── PeeringWithKobraLocksMainVnet/
│   │           │   ├── Name: "DRToMainPeering"
│   │           │   └── Settings: [AllowVirtualNetworkAccess: true, AllowForwardedTraffic: true, AllowGatewayTransit: false, UseRemoteGateways: false]
│   │           └── PeeringWithOtherVnets (if necessary)
│   ├── PrivateDNSZones/
│   │   ├── postgresql.database.azure.com/
│   │   │   ├── RecordSets/
│   │   │   │   └── dev-postgre-east-us
│   │   │   │       ├── Type: A
│   │   │   │       └── IP Address: <PostgreSQL Server IP>
│   │   │   ├── LinkToMainVnet: KobraLocksMainVnet-PostgreSQL-DNS-Link
│   │   │   └── LinkToDrvnet: KobraLocksDRVnet-PostgreSQL-DNS-Link
│   │   └── privatelink.blob.core.windows.net/
│   │       ├── RecordSets/
│   │       │   └── blobstorage
│   │       │       ├── Type: CNAME
│   │       │       └── Alias: <Blob Storage Account Private Endpoint Alias>
│   │       └── LinkToMainVnet: KobraLocksMainVnet-BlobStorage-DNS-Link
│   │
│   ├── ApplicationGateway/                            # Provides advanced HTTP-based load balancing and WAF
│   │   ├── GeneralSettings/                           # Basic configuration for Application Gateway
│   │   │   ├── SKU: "WAF_v2"                          # Use WAF_v2 for enhanced performance and WAF features
│   │   │   ├── Autoscale: "Enabled"                   # Enable autoscaling for demand-based performance
│   │   │   ├── InstanceCount: "2-10"                  # Minimum and maximum instance count for autoscaling
│   │   │   └── Http2: "Enabled"                       # Enable HTTP/2 for improved performance
│   │   ├── BackendPools/                              # Backend targets for routing traffic
│   │   │   ├── BackendAPI/                            # Routes traffic to the backend API services
│   │   │   │   └── Targets: ["<BackendAPIAppServiceURL>"] # URLs of backend API services
│   │   │   └── FrontendApp/                           # Directs client requests to the frontend application
│   │   │       └── Targets: ["<FrontendAppServiceURL>"]   # URLs of frontend App Service
│   │   ├── HttpListeners/                             # Listener configurations for incoming traffic
│   │   │   ├── FrontendHttpsListener/                 # HTTPS listener for secure traffic
│   │   │   │   ├── Protocol: "HTTPS"
│   │   │   │   ├── Port: 443
│   │   │   │   └── CustomDomain: "<yourcustomdomain.com>" # Custom domain for the listener
│   │   │   └── SslCertificate:                        # SSL certificate for HTTPS listener
│   │   │       └── Name: "FrontendAppSslCert"
│   │   ├── RoutingRules/                              # Defines how traffic is routed to backend pools
│   │   │   ├── PathBasedRules/                        # Use path-based routing for directing traffic
│   │   │   │   ├── APIRule:                           # Rule for API traffic
│   │   │   │   │   ├── PathPattern: "/api/*"
│   │   │   │   │   ├── BackendPool: "BackendAPI"
│   │   │   │   │   └── HttpListener: "FrontendHttpsListener"
│   │   │   │   └── AppRule:                           # Rule for frontend app traffic
│   │   │   │       ├── PathPattern: "/*"
│   │   │   │       ├── BackendPool: "FrontendApp"
│   │   │   │       └── HttpListener: "FrontendHttpsListener"
│   │   │   └── DefaultRoute:                          # Default route if no rule matches
│   │   │       ├── BackendPool: "FrontendApp"
│   │   │       └── HttpListener: "FrontendHttpsListener"
│   │   └── WAFConfig/                                 # Web Application Firewall configurations
│   │       ├── Enabled: "True"
│   │       ├── Mode: "Prevention"                     # Set WAF to actively prevent detected threats
│   │       ├── RuleSetVersion: "OWASP 3.1"            # Specify OWASP rule set version
│   │       ├── ManagedRules:                          # Employs pre-defined rulesets for common web threats
│   │       │   └── RuleGroups: ["OWASP Top 10"]
│   │       └── CustomRules:                           # Define custom rules for specific requirements
│   │           └── Name: "BlockSpecificUserAgents"
│   │               ├── Priority: 100
│   │               ├── RuleType: "MatchRule"
│   │               ├── MatchConditions: [{"MatchVariables": "RequestHeaders", "Operator": "Contains", "MatchValues": ["BadBot"]}]
│   │               └── Action: "Block"
│   │
│   └── NetworkSecurityGroups/
│       ├── AppServicesNSG/
│       │   └── Rules:
│       │       ├── AllowHTTPS
│       │       │   ├── Priority: 100
│       │       │   ├── Direction: Inbound
│       │       │   ├── Access: Allow
│       │       │   ├── Protocol: TCP
│       │       │   ├── Source Port Range: *
│       │       │   ├── Destination Port Range: 443
│       │       │   ├── Source: Any
│       │       │   ├── Destination: VirtualNetwork
│       │       │   └── Service: HTTPS
│       │       └── DenyAllOutbound
│       │           ├── Priority: 200
│       │           ├── Direction: Outbound
│       │           ├── Access: Deny
│       │           ├── Protocol: Any
│       │           ├── Source Port Range: *
│       │           ├── Destination Port Range: *
│       │           ├── Source: VirtualNetwork
│       │           ├── Destination: Internet
│       │           └── Service: Custom
│       ├── DatabaseNSG/
│       │   └── Rules:
│       │       ├── AllowVnetInbound
│       │       │   ├── Priority: 100
│       │       │   ├── Direction: Inbound
│       │       │   ├── Access: Allow
│       │       │   ├── Protocol: TCP
│       │       │   ├── Source Port Range: *
│       │       │   ├── Destination Port Range: 5432
│       │       │   ├── Source: VirtualNetwork
│       │       │   ├── Destination: VirtualNetwork
│       │       │   └── Service: PostgreSQL
│       │       └── DenyAllOutbound
│       │           ├── Priority: 200
│       │           ├── Direction: Outbound
│       │           ├── Access: Deny
│       │           ├── Protocol: Any
│       │           ├── Source Port Range: *
│       │           ├── Destination Port Range: *
│       │           ├── Source: VirtualNetwork
│       │           ├── Destination: Internet
│       │           └── Service: Custom
│       ├── AKSNSG/
│       │   └── Rules:
│       │       ├── AllowAKSToAppServices
│       │       │   ├── Priority: 100
│       │       │   ├── Direction: Inbound
│       │       │   ├── Access: Allow
│       │       │   ├── Protocol: TCP
│       │       │   ├── Source Port Range: *
│       │       │   ├── Destination Port Range: 443
│       │       │   ├── Source: VirtualNetwork
│       │       │   ├── Destination: VirtualNetwork
│       │       │   └── Service: HTTPS
│       │       ├── AllowAKSToDatabase
│       │       │   ├── Priority: 110
│       │       │   ├── Direction: Inbound
│       │       │   ├── Access: Allow
│       │       │   ├── Protocol: TCP
│       │       │   ├── Source Port Range: *
│       │       │   ├── Destination Port Range: 5432
│       │       │   ├── Source: VirtualNetwork
│       │       │   ├── Destination: VirtualNetwork
│       │       │   └── Service: PostgreSQL
│       │       └── DenyAllOutbound
│       │           ├── Priority: 200
│       │           ├── Direction: Outbound
│       │           ├── Access: Deny
│       │           ├── Protocol: Any
│       │           ├── Source Port Range: *
│       │           ├── Destination Port Range: *
│       │           ├── Source: VirtualNetwork
│       │           ├── Destination: Internet
│       │           └── Service: Custom
│       ├── AppGatewayNSG/
│       │   └── Rules:
│       │       ├── AllowHTTPandHTTPSInbound
│       │       │   ├── Priority: 100
│       │       │   ├── Direction: Inbound
│       │       │   ├── Access: Allow
│       │       │   ├── Protocol: TCP
│       │       │   ├── Source Port Range: *
│       │       │   ├── Destination Port Range: 80,443
│       │       │   ├── Source: Any
│       │       │   └── Destination: Any
│       │       └── DenyAllOutbound
│       │           ├── Priority: 200
│       │           ├── Direction: Outbound
│       │           ├── Access: Deny
│       │           ├── Protocol: Any
│       │           ├── Source Port Range: *
│		│			├── Service: Custom
│       │           └── Destination Port Range: *
│       └── PrivateEndpointsNSG/                      # Dedicated NSG for PrivateEndpointSubnet
│           └── Rules:
│               ├── AllowPrivateEndpointTraffic
│               │   ├── Priority: 100
│               │   ├── Direction: Inbound
│               │   ├── Access: Allow
│               │   ├── Protocol: TCP
│               │   ├── Source Port Range: *
│               │   ├── Destination Port Range: *
│               │   ├── Source: VirtualNetwork, ServiceTag (AzurePrivateLink)
│               │   └── Destination: VirtualNetwork
│               │   └── Service: Custom               # Since it covers a wide range of Azure services
│               ├── AllowAzureLoadBalancerInbound
│               │   ├── Priority: 110
│               │   ├── Direction: Inbound
│               │   ├── Access: Allow
│               │   ├── Protocol: TCP
│               │   ├── Source Port Range: *
│               │   ├── Destination Port Range: *
│               │   ├── Source: AzureLoadBalancer     # Specifically allowing Azure Load Balancer
│               │   └── Destination: VirtualNetwork
│               │   └── Service: Custom               # Allowing Azure Load Balancer to access VNet
│               └── DenyAllNonVNetTraffic
│                   ├── Priority: 200
│                   ├── Direction: Inbound
│                   ├── Access: Deny
│                   ├── Protocol: TCP
│                   ├── Source Port Range: *
│                   ├── Destination Port Range: *
│                   ├── Source: Any (excluding VirtualNetwork, AzurePrivateLink ServiceTags)
│                   └── Destination: Any
│                   └── Service: Custom               # This rule ensures that only VNet and Private Link traffic is allowed
│
├── AppServices/
│   ├── KobraLocksBackend/
│   │   ├── Networking/
│   │   │   ├── VNet Integration/
│   │   │   │   └── Subnet: "AppServiceSubnet"
│   │   └── Microsoft Defender for Cloud: Enabled
│   └── KobraLocksFrontend/
│       ├── Networking/
│       │   ├── VNet Integration/
│       │   │   └── Subnet: "AppServiceSubnet"
│       └── Microsoft Defender for Cloud: Enabled
│
└── Databases/
    ├── PostgreSQL/
    │   ├── Server/
    │   │   ├── Networking/
    │   │   │   ├── VNet Integration/
    │   │   │   │   └── Subnet: "DatabaseSubnet"
    │   │   │   ├── Private Endpoint/
    │   │   │   │   ├── Subnet: <Dedicated Subnet for Private Endpoints>
    │   │   │   │   └── PrivateDNSZone: "postgresql.database.azure.com"
    │   │   │   ├── ServiceEndpoints: Configured if Public Access is needed
    │   │   │   └── Connection Policies: Set to Redirect or Proxy based on performance requirements
    │   │   └── Microsoft Defender for Cloud: Enabled
    │   ├── PrivateDNSZoneLink/
    │   │   └── LinkTo: "postgresql.database.azure.com"
    └── CosmosDB/
        └── Networking/
            ├── VirtualNetworkServiceEndpoints/
            │   └── EnabledFor: "KobraLocksMainVnet"
            └── Microsoft Defender for Cloud: Enabled
